let e=null;function t({target:{files:t}}){const o=t[0];if(document.getElementById("logoError").style.display="none",!o)return;if(!o.type.startsWith("image/"))return n("Please select an image file (PNG, JPG, GIF)");if(o.size>204800)return n(`File size (${(o.size/1024).toFixed(2)}KB) exceeds 200KB limit. Please reduce your logo size. You can use a fee online image compressor tool.</a>`);e=o;const a=new FileReader;a.onload=e=>{document.getElementById("logoPreview").src=e.target.result,document.getElementById("logoUploadArea").style.display="none",document.getElementById("logoPreviewArea").style.display="block"},a.readAsDataURL(o)}function n(t){const n=document.getElementById("logoError");n.textContent=t,n.style.display="block",e=null}async function o(t){if(t.preventDefault(),!e)return n("Please select a logo to upload");const o=new FormData;o.append("logo",e);const a=document.getElementById("logoUploadProgress"),l=document.getElementById("logoProgressBar"),d=document.getElementById("logoProgressText"),s=document.getElementById("logoSubmitBtn");a.style.display="block",s.disabled=!0;try{const t=new XMLHttpRequest;t.upload.addEventListener("progress",e=>{if(e.lengthComputable){const t=e.loaded/e.total*100;l.style.width=t+"%",d.textContent=`Uploading... ${Math.round(t)}%`}}),t.addEventListener("load",()=>{if(200===t.status){const{success:o,message:l}=JSON.parse(t.responseText);o?(d.textContent="Upload complete!",setTimeout(()=>{document.getElementById("logoModal").style.display="none",document.getElementById("logoForm").reset(),document.getElementById("logoUploadArea").style.display="block",document.getElementById("logoPreviewArea").style.display="none",document.getElementById("logoUploadProgress").style.display="none",document.getElementById("logoError").style.display="none",document.getElementById("logoSubmitBtn").disabled=!1,e=null,location.reload()},1e3)):(n(l||"Upload failed"),a.style.display="none",s.disabled=!1)}else n("Upload failed. Please try again."),a.style.display="none",s.disabled=!1}),t.addEventListener("error",()=>{n("Network error. Please check your connection."),a.style.display="none",s.disabled=!1}),t.open("POST","/dashboard/settings/logo",!0),t.send(o)}catch{n("An error occurred. Please try again."),a.style.display="none",s.disabled=!1}}async function a(e){e.preventDefault();const t=new FormData;t.append("financial_secretary_name",document.getElementById("financialSecretaryName").value),t.append("financial_secretary_phone",document.getElementById("financialSecretaryPhone").value),t.append("treasurer_name",document.getElementById("treasurerName").value),t.append("treasurer_phone",document.getElementById("treasurerPhone").value);try{const e=await fetch("/dashboard/settings/officials",{method:"POST",body:t}),{success:n,message:o}=await e.json();alert(n?"Officials information updated successfully!":o||"Failed to update officials information"),n&&closeOtherOfficialsModal()}catch(e){alert("An error occurred. Please try again."),console.error("Error:",e)}}document.addEventListener("DOMContentLoaded",()=>{!function(){const e=document.getElementById("logoFileInput"),n=document.getElementById("logoUploadArea"),a=document.getElementById("logoForm");n.addEventListener("click",()=>e.click()),e.addEventListener("change",t),n.addEventListener("dragover",e=>{e.preventDefault(),n.classList.add("dragover")}),n.addEventListener("dragleave",()=>n.classList.remove("dragover")),n.addEventListener("drop",o=>{o.preventDefault(),n.classList.remove("dragover");const a=o.dataTransfer.files;a.length&&(e.files=a,t({target:{files:a}}))}),a.addEventListener("submit",o)}();const e=document.getElementById("otherOfficialsForm");e&&e.addEventListener("submit",a),document.getElementById("logoSubmitBtn").disabled=!0,document.getElementById("officialsSubmitBtn").disabled=!0,async function(){try{const e=await fetch("/dashboard/settings/fetchsettings"),{success:t,officials:n,logo:o}=await e.json();t&&(n.financial_secretary&&(document.getElementById("financialSecretaryName").value=n.financial_secretary.name||"",document.getElementById("financialSecretaryPhone").value=n.financial_secretary.phone||""),n.treasurer&&(document.getElementById("treasurerName").value=n.treasurer.name||"",document.getElementById("treasurerPhone").value=n.treasurer.phone||""),o&&(document.getElementById("logoPreview").src=o,document.getElementById("logoUploadArea").style.display="none",document.getElementById("logoPreviewArea").style.display="block"),document.getElementById("logoSubmitBtn").disabled=!1,document.getElementById("officialsSubmitBtn").disabled=!1)}catch(e){console.error("Failed to load settings:",e),document.getElementById("logoSubmitBtn").disabled=!1,document.getElementById("officialsSubmitBtn").disabled=!1}}()});