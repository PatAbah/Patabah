let e=null,t=!1,a=!1;const n=document.getElementById("shortname"),s=document.getElementById("validation-message"),o=document.getElementById("submit-btn"),i=document.getElementById("shortlink-form"),c=document.getElementById("form-section"),l=document.getElementById("success-section"),r=document.getElementById("created-link"),d=document.getElementById("copy-btn");n.addEventListener("input",function(n){this.value=this.value.toUpperCase();const i=n.target.value.trim();if(e&&clearTimeout(e),t=!1,o.disabled=!0,""===i)return s.textContent="",void(s.className="validation-message");const c=function(e){return e.length<2?{valid:!1,message:"Shortname must be at least 2 characters"}:e.length>21?{valid:!1,message:"Shortname must be at most 21 characters"}:/^[a-zA-Z0-9_-]+$/.test(e)?{valid:!0,message:""}:{valid:!1,message:"Only letters,numbers,hyphens,and underscores allowed"}}(i);if(!c.valid)return s.textContent=c.message,void(s.className="validation-message error");e=setTimeout(()=>{!async function(e){a=!0,s.textContent="Checking availability...",s.className="validation-message checking",o.disabled=!0;try{const n=await fetch("/ajax/association/check-shortname",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({shortname:e})}),i=await n.json();a=!1,!0===i?(s.textContent="This shortname is already taken",s.className="validation-message unavailable",t=!1,o.disabled=!0):(s.textContent="âœ“ This shortname is available",s.className="validation-message available",t=!0,o.disabled=!1)}catch(e){a=!1,s.textContent="Error checking availability.Please try again.",s.className="validation-message error",t=!1,o.disabled=!0}}(i)},500)}),i.addEventListener("submit",async function(e){if(e.preventDefault(),!t||a)return;const i=n.value.trim();o.disabled=!0,o.textContent="Creating...";try{const e=await fetch("/ajax/association/shortname",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({shortname:i})}),t=await e.json();if(t.success){const e=`${window.location.origin}${t.pay_url}`;r.value=e,c.style.display="none",l.style.display="block"}else s.textContent=t.message||"Failed to create shortlink.Please try again.",s.className="validation-message error",o.disabled=!1,o.textContent="Create Shortlink"}catch(e){console.error("Error:",e),s.textContent="Network error occurred.Please check your connection and try again.",s.className="validation-message error",o.disabled=!1,o.textContent="Create Shortlink"}}),d.addEventListener("click",function(){r.select(),r.setSelectionRange(0,99999),navigator.clipboard.writeText(r.value).then(function(){const e=d.textContent;d.textContent="Copied!",d.classList.add("copied"),setTimeout(function(){d.textContent=e,d.classList.remove("copied")},2e3)}).catch(function(){document.execCommand("copy");const e=d.textContent;d.textContent="Copied!",d.classList.add("copied"),setTimeout(function(){d.textContent=e,d.classList.remove("copied")},2e3)})});