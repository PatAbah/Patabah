let t,e;function n(n="30"){console.log("Loading chart data for range:",n);const o=document.getElementById("revenueChart")?.parentElement,a=document.getElementById("volumeChart")?.parentElement;!function(t,e){const n='<div style="text-align: center; padding: 20px; color: var(--text-light);">Loading chart data...</div>';t&&(t.innerHTML=n+'<canvas id="revenueChart"></canvas>');e&&(e.innerHTML=n+'<canvas id="volumeChart"></canvas>')}(o,a),fetch("/ajax/dashboard/chart-data?range="+n).then(t=>t.json()).then(n=>{console.log("Chart data response:",n),n.success&&n.stats&&n.stats.length>0?function(n){console.log("Creating charts with data:",n),t&&(t.destroy(),t=null);e&&(e.destroy(),e=null);requestAnimationFrame(()=>{!function(e){const n=document.getElementById("revenueChart");if(!n)return void console.error("Revenue chart canvas not found");const o=n.getContext("2d");if(!o)return void console.error("Cannot get 2D context for revenue chart");const a=e.map(t=>{try{const[e,n]=t.month.split("-");return new Date(e,n-1).toLocaleDateString("en-US",{year:"numeric",month:"short"})}catch(e){return t.month}}),r=e.map(t=>parseFloat(t.total_amount)||0);t=new Chart(o,{type:"line",data:{labels:a,datasets:[{label:"Revenue (₦)",data:r,borderColor:"#af4c02",backgroundColor:"rgba(175, 76, 2, 0.1)",borderWidth:2,fill:!0,tension:.4}]},options:{responsive:!0,maintainAspectRatio:!0,aspectRatio:2,plugins:{legend:{display:!0,position:"top"},tooltip:{callbacks:{label:function(t){return"₦"+t.parsed.y.toLocaleString()}}}},scales:{y:{beginAtZero:!0,ticks:{callback:function(t){return"₦"+t.toLocaleString()}}}}}}),console.log("Revenue chart created successfully")}(n),function(t){const n=document.getElementById("volumeChart");if(!n)return void console.error("Volume chart canvas not found");const o=n.getContext("2d");if(!o)return void console.error("Cannot get 2D context for volume chart");const a=t.map(t=>{try{const[e,n]=t.month.split("-");return new Date(e,n-1).toLocaleDateString("en-US",{year:"numeric",month:"short"})}catch(e){return t.month}}),r=t.map(t=>parseInt(t.payment_count)||0);e=new Chart(o,{type:"bar",data:{labels:a,datasets:[{label:"Payment Count",data:r,backgroundColor:"rgba(180, 133, 0, 0.7)",borderColor:"#b48500",borderWidth:1}]},options:{responsive:!0,maintainAspectRatio:!0,aspectRatio:2,plugins:{legend:{display:!0,position:"top"}},scales:{y:{beginAtZero:!0,ticks:{stepSize:1}}}}}),console.log("Volume chart created successfully")}(n)})}(n.stats):function(t,e){const n='<div style="text-align: center; padding: 20px; color: var(--text-light);">No payment data available for charts</div>';t&&(t.innerHTML=n);e&&(e.innerHTML=n)}(o,a)}).catch(t=>{console.error("Error loading chart data:",t),function(t,e){const n='<div style="text-align: center; padding: 20px; color: var(--error-color);">Error loading chart data</div>';t&&(t.innerHTML=n);e&&(e.innerHTML=n)}(o,a)})}document.addEventListener("DOMContentLoaded",function(){!function(){const t=document.getElementById("revenueChart"),e=document.getElementById("volumeChart");t&&e&&n("30")}()}),window.dashboardCharts={refreshCharts:function(){const t=document.getElementById("timeRange");if(!t)return;const e=t.value;console.log("Refreshing charts with range:",e),n(e)},loadChartData:n};